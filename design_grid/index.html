<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design Grid</title>
    
    <!-- Open Graph Meta Tags for Social Media Sharing -->
    <meta property="og:title" content="Design Grid">
    <meta property="og:description" content="A modern grid showcase">
    <meta property="og:url" content="https://projects.izel.website/design_grid">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Design Grid">
    <meta name="twitter:description" content="A modern grid showcase">
    
    <link rel="stylesheet" href="/design_grid/styles/design_grid.css">
</head>
<body>
    <!-- Fixed Top Navigation -->
    <nav class="top-nav">
        <p class="top-left">Izel Maras</p>
        <p class="top-right">Designer</p>
    </nav>

    <!-- Main Content -->
    <div class="page-container">
            <div class="grid-container">
                <div class="grid">
                    <div class="grid-item item-1" data-page="work1">
                    <img src="/design_grid/assets/work1.png" alt="Work 1" class="grid-image">
                </div>
                    <div class="grid-item item-2" data-page="work2">
                    <img src="/design_grid/assets/work2.png" alt="Work 2" class="grid-image">
                </div>
                    <div class="grid-item item-3" data-page="work3">
                    <img src="/design_grid/assets/work3.png" alt="Work 3" class="grid-image">
                </div>
                    <div class="grid-item item-4" data-page="work4">
                    <img src="/design_grid/assets/work4.png" alt="Work 4" class="grid-image">
                </div>
                    <div class="grid-item item-5" data-page="work5">
                    <img src="/design_grid/assets/work5.png" alt="Work 5" class="grid-image">
                </div>
                    <div class="grid-item item-6" data-page="work6">
                    <img src="/design_grid/assets/work6.png" alt="Work 6" class="grid-image">
                </div>
                    <div class="grid-item item-7" data-page="work7">
                    <img src="/design_grid/assets/work7.png" alt="Work 7" class="grid-image">
                </div>
                    <div class="grid-item item-8" data-page="work8">
                    <img src="/design_grid/assets/work8.png" alt="Work 8" class="grid-image">
                </div>
            </div>
        </div>
    </div>

    <!-- Fixed Bottom Navigation -->
    <nav class="bottom-nav">
        <button type="button" class="bottom-nav__about" data-page="about">About</button>
        <a class="bottom-nav__link" href="https://www.izelmaras.com" target="_blank" rel="noopener noreferrer">izel.website</a>
    </nav>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <header class="modal-header">
                <div class="modal-header__center">
                    <div class="modal-floating-toggle"></div>
                </div>
                <button type="button" class="close" aria-label="Close modal">&times;</button>
            </header>
            <div class="modal-body">
                <div class="modal-body__header">
                    <div class="modal-header__meta">
                        <span class="modal-header__title">Project</span>
                        <p class="modal-header__description"></p>
                    </div>
                </div>
                <div class="modal-body__content"></div>
            </div>
            <div class="modal-progress">
                <div class="modal-progress__bar"></div>
            </div>
        </div>
    </div>

    <script>
        const modal = document.getElementById('modal');
        const modalContent = document.querySelector('.modal-content');
        const modalBody = document.querySelector('.modal-body');
        const closeBtn = document.querySelector('.close');
        const modalContentArea = document.querySelector('.modal-body__content');
        const headerTitle = document.querySelector('.modal-header__title');
        const headerDescription = document.querySelector('.modal-header__description');
        const floatingToggle = document.querySelector('.modal-floating-toggle');
        const progressTrack = document.querySelector('.modal-progress');
        const progressBar = document.querySelector('.modal-progress__bar');
        const pageTriggers = document.querySelectorAll('[data-page]');
        const validPages = Array.from(pageTriggers).map(item => item.dataset.page);
        const basePagePath = '/design_grid/pages/';

        let currentPage = null;
        let isDragging = false;
        let isLoading = false;
        let startX, startY, startLeft, startTop;

        const resetModalPosition = () => {
            modalContent.style.left = '';
            modalContent.style.top = '';
        };

        const setModalVisibility = (show) => {
            modal.style.display = show ? 'block' : 'none';
            document.body.style.overflow = show ? 'hidden' : 'auto';
            resetModalPosition();
        };

        const setHistoryState = (pageId, { replace = false } = {}) => {
            const url = new URL(window.location.href);
            if (pageId) {
                url.searchParams.set('view', pageId);
            } else {
                url.searchParams.delete('view');
            }

            if (replace) {
                history.replaceState(pageId ? { view: pageId } : {}, '', url);
            } else {
                history.pushState(pageId ? { view: pageId } : {}, '', url);
            }
        };

        const clearModalContent = () => {
            modalContentArea.innerHTML = '';
            currentPage = null;
            if (headerTitle) {
                headerTitle.textContent = 'Project';
            }
            if (headerDescription) {
                headerDescription.textContent = '';
            }
            if (floatingToggle) {
                floatingToggle.innerHTML = '';
                floatingToggle.classList.remove('is-active');
            }
            if (progressBar) {
                progressBar.style.transform = 'scaleX(0)';
            }
            if (progressTrack) {
                progressTrack.classList.remove('is-active');
            }
        };

        const showLoading = () => {
            modalContentArea.innerHTML = '<div class="modal-loading">Loading...</div>';
            if (headerTitle) {
                headerTitle.textContent = 'Loading';
            }
            if (headerDescription) {
                headerDescription.textContent = '';
            }
            if (floatingToggle) {
                floatingToggle.innerHTML = '';
                floatingToggle.classList.remove('is-active');
            }
            if (progressBar) {
                progressBar.style.transform = 'scaleX(0)';
            }
            if (progressTrack) {
                progressTrack.classList.remove('is-active');
            }
        };

        const showError = () => {
            modalContentArea.innerHTML = `
                <div class="modal-error">
                    <h3>Something went wrong</h3>
                    <p>We couldn\'t load that project. Please try again.</p>
                </div>
            `;
            if (headerTitle) {
                headerTitle.textContent = 'Load error';
            }
            if (headerDescription) {
                headerDescription.textContent = '';
            }
            if (floatingToggle) {
                floatingToggle.innerHTML = '';
                floatingToggle.classList.remove('is-active');
            }
            if (progressBar) {
                progressBar.style.transform = 'scaleX(0)';
            }
            if (progressTrack) {
                progressTrack.classList.remove('is-active');
            }
        };

        function updateProgress() {
            if (!progressBar) {
                return;
            }
            const scrollableHeight = modalBody.scrollHeight - modalBody.clientHeight;
            const ratio = scrollableHeight > 0 ? modalBody.scrollTop / scrollableHeight : 0;
            progressBar.style.transform = `scaleX(${ratio})`;
        }

        const initializeModalPage = (root, pageId) => {
            const page = root.querySelector(`[data-modal-page="${pageId}"]`);
            if (!page) {
                return;
            }
            const name = page.getAttribute('data-page-name') || pageId;
            const description = page.getAttribute('data-page-description') || '';
            if (headerTitle) {
                headerTitle.textContent = name;
            }
            if (headerDescription) {
                headerDescription.textContent = description;
            }

            const toggleGroup = page.querySelector('.modal-toggle');
            if (floatingToggle) {
                floatingToggle.innerHTML = '';
                floatingToggle.classList.remove('is-active');
                if (toggleGroup) {
                    floatingToggle.appendChild(toggleGroup);
                    floatingToggle.classList.add('is-active');
                }
            }

            if (toggleGroup) {
                const options = toggleGroup.querySelectorAll('.modal-toggle__option');
                const panes = page.querySelectorAll('.modal-page__pane');

                const activatePane = (targetId) => {
                    options.forEach((option) => {
                        const isActive = option.dataset.paneTarget === targetId;
                        option.classList.toggle('is-active', isActive);
                        option.setAttribute('aria-selected', isActive ? 'true' : 'false');
                        option.setAttribute('tabindex', isActive ? '0' : '-1');
                    });

                    panes.forEach((pane) => {
                        const isMatch = pane.dataset.pane === targetId;
                        pane.classList.toggle('is-active', isMatch);
                        pane.setAttribute('aria-hidden', isMatch ? 'false' : 'true');
                    });
                    updateProgress();
                };

                options.forEach((option) => {
                    option.addEventListener('click', () => {
                        if (!option.classList.contains('is-active')) {
                            activatePane(option.dataset.paneTarget);
                        }
                    });

                    option.addEventListener('keydown', (event) => {
                        if (event.key === 'ArrowRight' || event.key === 'ArrowLeft') {
                            event.preventDefault();
                            const currentIndex = Array.from(options).indexOf(option);
                            const direction = event.key === 'ArrowRight' ? 1 : -1;
                            const nextIndex = (currentIndex + direction + options.length) % options.length;
                            const nextOption = options[nextIndex];
                            nextOption.focus();
                            if (!nextOption.classList.contains('is-active')) {
                                activatePane(nextOption.dataset.paneTarget);
                            }
                        }
                    });
                });

                const activeOption = toggleGroup.querySelector('.modal-toggle__option.is-active') || options[0];
                if (activeOption) {
                    activatePane(activeOption.dataset.paneTarget);
                }
            }
        };

        const openModal = async (pageId, { skipHistory = false, replaceState = false } = {}) => {
            if (!validPages.includes(pageId) || isLoading) {
                return;
            }

            isLoading = true;
            setModalVisibility(true);
            showLoading();

            try {
                const response = await fetch(`${basePagePath}${pageId}.html`, { cache: 'no-cache' });
                if (!response.ok) {
                    throw new Error('Failed to fetch page');
                }
                const html = await response.text();
                modalContentArea.innerHTML = html;
                initializeModalPage(modalContentArea, pageId);
                modalBody.scrollTop = 0;
                if (progressTrack) {
                    progressTrack.classList.add('is-active');
                }
                if (progressBar) {
                    progressBar.style.transform = 'scaleX(0)';
                }
                updateProgress();
                currentPage = pageId;

                if (!skipHistory) {
                    setHistoryState(pageId, { replace: replaceState });
                }
                if (replaceState && skipHistory) {
                    setHistoryState(pageId, { replace: true });
                }
            } catch (error) {
                console.error(error);
                showError();
            } finally {
                isLoading = false;
            }
        };

        const closeModal = ({ skipHistory = false, replaceState = false } = {}) => {
            if (modal.style.display !== 'block') {
                return;
            }

            setModalVisibility(false);
            clearModalContent();

            if (!skipHistory) {
                setHistoryState(null, { replace: replaceState });
            }
            if (replaceState && skipHistory) {
                setHistoryState(null, { replace: true });
            }
        };

        pageTriggers.forEach(item => {
            item.addEventListener('click', () => {
                const pageId = item.dataset.page;
                openModal(pageId);
            });
        });

        modalBody.addEventListener('scroll', updateProgress);

        closeBtn.addEventListener('click', () => closeModal());

        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                closeModal();
            }
        });

        window.addEventListener('resize', () => {
            if (modal.style.display === 'block' && !isDragging) {
                resetModalPosition();
            }
        });

        window.addEventListener('popstate', (event) => {
            const view = event.state && event.state.view ? event.state.view : new URL(window.location.href).searchParams.get('view');
            if (view && validPages.includes(view)) {
                openModal(view, { skipHistory: true, replaceState: true });
            } else {
                closeModal({ skipHistory: true, replaceState: true });
            }
        });

        // Drag functionality - Mouse
        modalContent.addEventListener('mousedown', function(e) {
            if (window.innerWidth > 768 && (e.target.classList.contains('modal-header') || e.target.classList.contains('close'))) {
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                startLeft = modalContent.offsetLeft;
                startTop = modalContent.offsetTop;
            }
        });

        document.addEventListener('mousemove', function(e) {
            if (isDragging) {
                e.preventDefault();
                modalContent.style.left = (startLeft + e.clientX - startX) + 'px';
                modalContent.style.top = (startTop + e.clientY - startY) + 'px';
            }
        });

        document.addEventListener('mouseup', function() {
            isDragging = false;
        });

        // Drag functionality - Touch (disabled on mobile for better scrolling)
        modalContent.addEventListener('touchstart', function(e) {
            if (window.innerWidth > 768 && (e.target.classList.contains('modal-header') || e.target.classList.contains('close'))) {
                isDragging = true;
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
                startLeft = modalContent.offsetLeft;
                startTop = modalContent.offsetTop;
            }
        }, { passive: true });

        document.addEventListener('touchmove', function(e) {
            if (isDragging && window.innerWidth > 768) {
                e.preventDefault();
                modalContent.style.left = (startLeft + e.touches[0].clientX - startX) + 'px';
                modalContent.style.top = (startTop + e.touches[0].clientY - startY) + 'px';
            }
        }, { passive: false });

        document.addEventListener('touchend', function() {
            isDragging = false;
        });

        // Resize functionality
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Initial load: open modal if URL includes view param
        const initialView = new URL(window.location.href).searchParams.get('view');
        if (initialView && validPages.includes(initialView)) {
            openModal(initialView, { skipHistory: true, replaceState: true });
        } else {
            // ensure base state registered if no view
            history.replaceState({}, '', window.location.href);
        }
    </script>
</body>
</html>

